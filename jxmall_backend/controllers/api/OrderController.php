<?php
/**
 * @link:http://www.dujxmall.com/
 * @copyright: Copyright (c) 2020 广州动力宇宙信息科技
 * Created by PhpStorm
 * Author: ganxiaohao
 * Date: 2020-09-17
 * Time: 17:20
 */

namespace app\controllers\api;

use app\controllers\api\filters\LoginFilter;
use app\forms\api\order\ApplySendForm;
use app\forms\api\order\OrderForm;
use app\forms\api\order\OrderListForm;
use app\forms\api\order\OrderPayDataForm;
use app\forms\api\order\OrderPreviewForm;
use app\forms\api\order\OrderSubmitForm;
use app\forms\api\order\QueryPayForm;
use app\forms\api\order\RefundForm;
use app\forms\api\user\UserAddressForm;

class OrderController extends Controller
{
    public function behaviors()
    {
        return array_merge(parent::behaviors(),
            ['login' => LoginFilter::class]
        ); // TODO: Change the autogenerated stub
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2022-01-24
     * @Time: 19:18
     * @Note:物流
     * @return \yii\web\Response
     */
    public function actionExpress()
    {
        $form = new OrderForm();
        $form->attributes = $this->request->get();
        return $this->asJson($form->getExpress());
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-10-11
     * @Time: 21:23
     * @Note:订单预览
     */
    public function actionOrderPreview()
    {
        $form = new OrderPreviewForm();
        $form->attributes = $this->request->post();
        return $this->asJson($form->search());
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-09-17
     * @Time: 17:21
     * @Note:订单提交
     */
    public function actionSubmit()
    {
        $form = new OrderSubmitForm();
        $form->attributes = $this->request->post();
        return $this->asJson($form->submit());
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-09-30
     * @Time: 23:44
     * @Note:支付信息
     * @return \yii\web\Response
     */
    public function actionPayData()
    {
        $form = new OrderPayDataForm();
        if ($this->request->isPost) {
            $form->attributes = $this->request->post();
            return $this->asJson($form->pay());
        }
        $form->attributes = $this->request->get();
        return $this->asJson($form->search());
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-09-30
     * @Time: 23:44
     * @Note:订单列表
     * @return \yii\web\Response
     */
    public function actionList()
    {
        $form = new OrderListForm();
        $form->attributes = $this->request->get();
        return $this->asJson($form->getList());
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-09-30
     * @Time: 23:44
     * @Note:订单详情
     * @return \yii\web\Response
     */
    public function actionDetail()
    {
        $form = new OrderForm();
        $form->attributes = $this->request->get();
        return $this->asJson($form->detail());
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-09-30
     * @Time: 23:45
     * @Note:订单取消
     */
    public function actionCancel()
    {
        $form = new OrderForm();
        $form->attributes = $this->request->post();
        return $this->asJson($form->cancel());
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-10-15
     * @Time: 16:10
     * @Note:确认收货
     * @return \yii\web\Response
     */
    public function actionConfirm()
    {
        $form = new OrderForm();
        $form->attributes = $this->request->post();
        return $this->asJson($form->confirm());
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-10-17
     * @Time: 20:52
     * @Note: 退款
     * @return \yii\web\Response
     */
    public function actionRefund()
    {
        $form = new RefundForm();
        if ($this->request->isPost) {
            $form->attributes = $this->request->post();
            return $this->asJson($form->save());
        }
        $form->attributes = $this->request->get();
        return $this->asJson($form->preview());
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-11-13
     * @Time: 20:43
     * @Note:订单删除
     */
    public function actionDelete()
    {
        $form = new OrderForm();
        $form->attributes = $this->request->post();
        return $this->asJson($form->delete());
    }

    /**
     * Created by PhpStorm.
     * User：ganxi
     * Date：2022/4/29
     * Time：10:39
     * Note：支付查询
     */
    public function actionQueryPay()
    {
        $form = new QueryPayForm();
        $form->attributes = $this->request->get();
        return $this->asJson($form->query());
    }

    /**
     * Created by PhpStorm.
     * User：ganxi
     * Date：2022/5/2
     * Time：16:33
     * Note：申请发货
     */
    public function actionApplySend()
    {
        $form = new ApplySendForm();
        $form->attributes = $this->request->post();
        return $this->asJson($form->send());

    }
}