<?php
/**
 * @link:http://www.dujxmall.com/
 * @copyright: Copyright (c) 2020 广州动力宇宙信息科技
 * Created by PhpStorm
 * Author: ganxiaohao
 * Date: 2020-10-11
 * Time: 9:37
 */

namespace app\controllers\api;


use app\controllers\api\filters\LoginFilter;
use app\forms\api\goods\GoodsCommentForm;
use app\forms\api\goods\GoodsCommentListForm;
use app\forms\api\goods\GoodsFavoriteForm;
use app\forms\api\goods\GoodsForm;
use app\forms\api\goods\GoodsListForm;
use app\forms\api\goods\GoodsPosterForm;
use app\forms\api\mall\CatForm;


class GoodsController extends Controller
{

    public function behaviors()
    {
        return array_merge(parent::behaviors(), [
            'login' => [
                'class' => LoginFilter::class,
                'ignore' => ['list', 'goods', 'cat']

            ]
        ]); // TODO: Change the autogenerated stub
    }

    public function actionList()
    {
        $form = new GoodsListForm();
        $form->attributes = $this->request->get();
        return $this->asJson($form->getList());
    }

    public function actionGoods()
    {

        $form = new GoodsForm();
        $form->attributes = $this->request->get();
        return $this->asJson($form->search());
    }

    public function actionFavorite()
    {

        $form = new GoodsFavoriteForm();
        $form->attributes = $this->request->post();
        return $this->asJson($form->save());

    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-10-13
     * @Time: 20:09
     * @Note:商品评价
     */
    public function actionComment()
    {
        $form = new GoodsCommentForm();
        $form->attributes = $this->request->post();
        return $this->asJson($form->save());
    }

    public function actionCommentList()
    {
        $form = new GoodsCommentListForm();
        $form->attributes = $this->request->get();
        return $this->asJson($form->getList());
    }

    /**
     * @Author: 动力宇宙 ganxiaohao
     * @Date: 2020-10-13
     * @Time: 10:04
     * @Note:分类页面
     */
    public function actionCat()
    {
        $form = new CatForm();
        return $this->asJson($form->search());
    }

    public function actionCat2()
    {
        $form = new CatForm();
        return $this->asJson($form->search2());
    }

    /**
     * Created by PhpStorm.
     * User：ganxi
     * Date：2022/3/16
     * Time：17:54
     * Note：二级分类含有商品
     */
    public function actionCatGoods()
    {
        $form = new CatForm();
        return $this->asJson($form->searchCatWithGoods());
    }
}