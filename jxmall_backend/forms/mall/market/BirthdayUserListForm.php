<?php
/**
 * Created by PhpStorm.
 * User: ganxi
 * Date: 2022/3/12
 * Time: 20:55
 * Note:
 */

namespace app\forms\mall\market;


use app\core\ApiCode;
use app\helpers\ResponseHelper;
use app\models\BaseModel;
use app\models\User;

class BirthdayUserListForm extends BaseModel
{
    public $user_id;
    public $keyword;
    public $search_date;
    public $month;
    public $day;
    public $year;
    public $sign_time;


    public function rules()
    {
        return [
            [['user_id', 'month', 'day','year'], 'integer'],
            [['keyword'], 'string'],
            [['search_date','sign_time'], 'safe']
        ]; // TODO: Change the autogenerated stub
    }


    public function getList()
    {
        if (!$this->validate()) {
            return $this->responseErrorInfo();
        }

        $query = User::find();
        if ($this->keyword) {
            $query->andWhere(['like', 'nickname', $this->keyword]);
        }
        if ($this->user_id) {
            $query->andWhere(['id' => $this->user_id]);
        }

        $query->andFilterWhere(['month' => $this->month, 'day' => $this->day, 'year' => $this->year]);

        if ($this->search_date && is_array($this->search_date)) {
            $query->andWhere(['between', 'birthday', $this->search_date[0], $this->search_date[1]]);
        }

        if ($this->sign_time && is_array($this->sign_time)) {
            $query->andWhere(['between', 'create_time', $this->sign_time[0], $this->sign_time[1]]);
        }

        $list = $query->select('id,nickname,avatar_url,birthday')->orderBy('id desc')->asArray()->all();
        return ResponseHelper::send(ApiCode::CODE_SUCCESS, '', ['list' => $list]);
    }

}