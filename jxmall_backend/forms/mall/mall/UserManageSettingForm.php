<?php
/**
 * @link:http://www.dujxmall.com/
 * @copyright: Copyright (c) 2020 广州动力宇宙信息科技
 * Created by PhpStorm
 * Author: ganxiaohao
 * Date: 2020-10-12
 * Time: 22:43
 */

namespace app\forms\mall\mall;


use app\core\ApiCode;
use app\helpers\ImageHelper;
use app\helpers\OptionHelper;
use app\helpers\SerializeHelper;
use app\models\BaseModel;
use app\models\Tabbar;

class UserManageSettingForm extends BaseModel
{


    public $page_data;


    public function rules()
    {
        return [

            [['page_data'], 'string']
        ]; // TODO: Change the autogenerated stub
    }

    public function save()
    {
        if (!$this->validate()) {
            return $this->responseErrorInfo();
        }
        OptionHelper::set('user_manage_setting', SerializeHelper::decode($this->page_data), \Yii::$app->mall->id);
        return $this->apiResponse(ApiCode::CODE_SUCCESS, '保存成功');
    }

    public function search()
    {
        $userPageData = OptionHelper::get('user_manage_setting', \Yii::$app->mall->id);
        if (!$userPageData) {
            $userPageData = $this->getPageDefault();
        }
        return $this->apiResponse(ApiCode::CODE_SUCCESS, '', ['page_data' => $userPageData]);
    }

    private function getPageDefault()
    {

        $default['header'] = [
            'parent_label'=>'推荐人',
            'user_bg' => ImageHelper::getUrl('/assets/default/user/user_bg.png'),
            'avatar' => ImageHelper::getUrl('/assets/default/user/avatar.png'),
            'qrcode' => ImageHelper::getUrl('/assets/default/images/qrcode.png'),
            'balance' => [
                'name' => '余额'
            ],
            'price' => [
                'name' => '佣金'
            ],
            'integral' => [
                'name' => '积分'
            ],
        ];


        $default['menus'] = [
            'name' => '常用工具',
            'type' => 0,
            'list' => [
                [
                    'name' => '待付款',
                    'url' => '/pages/order/order?status=0',
                    'icon' => ImageHelper::getUrl('/assets/default/user/order0.png')
                ],
                [
                    'name' => '待发货',
                    'url' => '/pages/order/order?status=1',
                    'icon' => ImageHelper::getUrl('/assets/default/user/order1.png')
                ],
                [
                    'name' => '待收货',
                    'url' => '/pages/order/order?status=2',
                    'icon' => ImageHelper::getUrl('/assets/default/user/order2.png')
                ],
                [
                    'name' => '待评价',
                    'url' => '/pages/order/order?status=3',
                    'icon' => ImageHelper::getUrl('/assets/default/user/order3.png')
                ],
                [
                    'name' => '退款/售后',
                    'url' => '/pages/order/order?status=4',
                    'icon' => ImageHelper::getUrl('/assets/default/user/order4.png')
                ],
            ]
        ];
        $default['finance'] = [
            'name' => '我的资产',
            'type' => 0,
            'total' => [
                'name' => '累计佣金',

            ],
            'price' => [
                'name' => '佣金',

            ],
            'cashing' => [

                'name' => '提现中',

            ],
            'cash' => [
                'name' => '已提现',

            ],

        ];

        return $default;

    }
}