<?php
/**
 * @link:http://www.dujxmall.com/
 * @copyright: Copyright (c) 2020 广州动力宇宙信息科技
 * Created by PhpStorm
 * Author: ganxiaohao
 * Date: 2020-12-31
 * Time: 16:19
 */

namespace app\plugins\article\forms\mall;


use app\core\ApiCode;
use app\helpers\ResponseHelper;
use app\models\BaseModel;
use app\plugins\article\models\ArticleCat;

class ArticleCatForm extends BaseModel
{

    public $id;
    public $name;
    public $cover_pic;

    public function rules()
    {
        return [
            [['id'],'integer'],
            [['name', 'cover_pic'], 'string']
        ]; // TODO: Change the autogenerated stub
    }


    public function save()
    {
        if (!$this->validate()) {
            return $this->responseErrorInfo();
        }
        if (!$this->name) {
            return ResponseHelper::send(ApiCode::CODE_FAIL, '分类名称不能为空');
        }
        if (!$this->cover_pic) {
            return ResponseHelper::send(ApiCode::CODE_FAIL, '分类封面不能为空');
        }
        if ($this->id) {
            $cat = ArticleCat::getOne($this->id);
            if (!$cat) {
                return ResponseHelper::send(ApiCode::CODE_FAIL, '分类不存在！');
            }
        }
        if (!$cat) {
            $cat = new ArticleCat();
            $cat->mall_id = \Yii::$app->mall->id;
        }
        $cat->attributes = $this->attributes;
        if (!$cat->save()) {
            return $this->responseErrorMsg($cat);
        }
        return ResponseHelper::send(ApiCode::CODE_SUCCESS, '保存成功');
    }

    public function search()
    {


        $cat = ArticleCat::getOne($this->id);
        if (!$cat) {
            return ResponseHelper::send(ApiCode::CODE_FAIL, '文章不存在！');
        }
        return ResponseHelper::send(ApiCode::CODE_SUCCESS, '', ['cat' => $cat]);
    }

    public function delete()
    {
        $cat = ArticleCat::getOne($this->id);
        if (!$cat) {
            return ResponseHelper::send(ApiCode::CODE_FAIL, '文章不存在！');
        }
        $cat->is_delete = 1;
        if (!$cat->save()) {
            return $this->responseErrorMsg($cat);
        }
        return ResponseHelper::send(ApiCode::CODE_SUCCESS, '删除成功');
    }
}
