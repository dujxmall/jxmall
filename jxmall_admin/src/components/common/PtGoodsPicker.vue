<template>
	<div style="text-align: start;">
		<el-dialog title="选择商品" :visible.sync="dialogVisible" width="50%" :before-close="handleClose">
			<div>
				<el-row>
					<el-col :span="12">
						<div class="flex-row">
							<el-input v-model="keyword" placeholder="输入商品名称进行搜索"></el-input>
							<el-button @click="getList" type="primary" style="margin: 0 10px;">搜索</el-button>
						</div>
					</el-col>
				</el-row>
				<el-scrollbar style="height: 450px;">

					<el-table :data="list" style="width: 100%;" v-loading='is_loading'>
						<el-table-column label="商品">
							<template slot-scope="scope">
								<div class="flex-row">
									<el-image :src="scope.row.cover_pic" style="width: 60px;height: 60px;">
										<div slot="error" class="image-slot">
											<i class="el-icon-picture-outline"></i>
										</div>
									</el-image>
									<div style="padding: 20px;">
										{{scope.row.name}}
									</div>
								</div>
							</template>
						</el-table-column>
						<el-table-column prop="sponsor_price" label="团长价格">
						</el-table-column>
						<el-table-column prop="pt_price" label="拼团价格">
						</el-table-column>
						<el-table-column prop="pt_num" label="库存">
						</el-table-column>
						<el-table-column prop="activity_name" label="活动名称">
						</el-table-column>
						<el-table-column prop="success_num" label="成团人数">
						</el-table-column>
						<el-table-column label="操作">
							<template slot-scope="scope">
								<el-button size="mini" v-if="scope.row.selected==1" type="primary"
									@click="selectRow(scope.row,scope.$index)">
									已选
								</el-button>
								<el-button size="mini" v-if="scope.row.selected!==1"
									@click="selectRow(scope.row,scope.$index)" plain>
									选择
								</el-button>
							</template>
						</el-table-column>
					</el-table>

				</el-scrollbar>
				<pagination :pagination="pagination" @pageChange="getList" v-model="page"></pagination>
			</div>

			<span slot="footer" class="dialog-footer">
				<el-button @click="dialogVisible = false">取 消</el-button>
				<el-button type="primary" @click="confirm">确 定</el-button>
			</span>
		</el-dialog>
		<div style="line-height: normal;" :style="'display:'+(display?display:'inline-block')"
			@click="dialogVisible = !dialogVisible">
			<slot />
		</div>
	</div>
</template>

<script>
	export default {
		name: 'PtGoodsPicker',
		data() {
			return {
				list: [],
				page: 1,
				is_loading: false,
				pagination: null,
				selected_rows: [],
				dialogVisible: false,
				display: '',
				keyword: ''
			}
		},
		created() {
			this.getList();
		},
		methods: {
			getList() {
				this.is_loading = true;
				this.$request({
					url: '/plugin/pt/mall/goods/list',
					data: {
						page: this.page,
						keyword: this.keyword,
					}
				}).then(res => {
					this.is_loading = false;
					if (res.code == 0) {
						this.list = res.data.list;
						for (let i in this.list) {
							this.list[i].selected = 0;
						}
						this.pagination = res.data.pagination
					}
				})
			},
			handleClose() {
				this.dialogVisible = false;
			},
			selectRow(row, index) {
				if (row.selected != 1) {
					row.selected = 1;
					this.$set(this.list, index, row)
				} else {
					row.selected = 0;
					this.$set(this.list, index, row)
				}
				this.$forceUpdate();
			},
			confirm() {
				for (let i in this.list) {
					if (this.list[i].selected == 1) {
						this.selected_rows.push(this.list[i])
						this.list[i].selected = 0;
					}
				}
				if (this.selected_rows.length > 0) {
					this.$emit('selected', this.selected_rows)
				} else {
					this.$emit('selected', [])
				}
				this.dialogVisible = false;

			}

		}

	}
</script>

<style>
</style>
